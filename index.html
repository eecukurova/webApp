<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EralpAhmet Trading Company</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="config.js"></script>
  <!-- Google Sign-In API -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <!-- reCAPTCHA API -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>
<body class="text-gray-800 bg-gray-50 scroll-smooth">

  <!-- 🧱 Header -->
  <header class="bg-white shadow-md fixed w-full z-50">
    <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
      <div class="text-xl font-bold text-indigo-600">EralpAhmet Trading Co.</div>
      <nav class="space-x-6 hidden md:flex items-center">
        <a href="#hero" class="hover:text-indigo-500 font-medium">Ana Sayfa</a>
        <a href="#strategies" class="hover:text-indigo-500 font-medium">Stratejiler</a>
        <a href="#request" class="hover:text-indigo-500 font-medium">Strateji Talebi</a>
        <a href="#contact" class="hover:text-indigo-500 font-medium">İletişim</a>
        <a href="#" onclick="openAdminModal()" class="hover:text-indigo-500 font-medium">Admin</a>
        
        <!-- Authentication buttons -->
        <div id="authButtons" class="ml-4">
          <button id="loginBtn" onclick="openLoginModal()" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition">
            Giriş Yap
          </button>
          <div id="userInfo" class="hidden">
            <span id="userName" class="text-indigo-600 font-medium mr-2"></span>
            <button onclick="logout()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition">
              Çıkış Yap
            </button>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <!-- 🔐 Login Modal -->
  <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-800">Giriş Yap</h2>
        <button onclick="closeLoginModal()" class="text-gray-500 hover:text-gray-700">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      
      <form id="loginForm" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">E-posta</label>
          <input type="email" id="loginEmail" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Şifre</label>
          <input type="password" id="loginPassword" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
        </div>
        
        <!-- reCAPTCHA -->
        <div id="recaptchaContainer" class="g-recaptcha"></div>
        
        <!-- Test User Info -->
        <div class="bg-blue-50 border border-blue-200 rounded-md p-3">
          <p class="text-sm text-blue-700">
            <strong>Test Hesabı:</strong><br>
            Kullanıcı Adı: <code class="bg-blue-100 px-1 rounded">testuser</code><br>
            Şifre: <code class="bg-blue-100 px-1 rounded">testuser</code>
          </p>
        </div>
        
        <div class="space-y-3">
          <button type="submit" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 transition">
            Giriş Yap
          </button>
          
          <div class="text-center">
            <span class="text-gray-500">veya</span>
          </div>
          
          <!-- Google Sign-In Button -->
          <div id="googleSignInButton" class="flex justify-center"></div>
        </div>
      </form>
    </div>
  </div>

  <!-- 👨‍💼 Admin Login Modal -->
  <div id="adminModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg p-8 max-w-md w-full mx-4">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-800">Admin Girişi</h2>
        <button onclick="closeAdminModal()" class="text-gray-500 hover:text-gray-700">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      
      <form id="adminLoginForm" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Kullanıcı Adı</label>
          <input type="text" id="adminUsername" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Şifre</label>
          <input type="password" id="adminPassword" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
        </div>
        
        <button type="submit" class="w-full bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 transition">
          Admin Girişi
        </button>
      </form>
    </div>
  </div>

  <!-- 🎛️ Admin Panel -->
  <div id="adminPanel" class="fixed inset-0 bg-white hidden z-50 overflow-y-auto">
    <div class="bg-gray-900 text-white p-4">
      <div class="flex justify-between items-center">
        <h1 class="text-2xl font-bold">Admin Panel - Ticket Sistemi</h1>
        <button onclick="closeAdminPanel()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded">
          Çıkış Yap
        </button>
      </div>
    </div>
    
    <div class="p-6">
      <!-- Ticket Statistics -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="bg-blue-100 p-4 rounded-lg">
          <h3 class="text-lg font-semibold text-blue-800">Açık Talepler</h3>
          <p class="text-3xl font-bold text-blue-600" id="openTickets">0</p>
        </div>
        <div class="bg-yellow-100 p-4 rounded-lg">
          <h3 class="text-lg font-semibold text-yellow-800">Devam Eden</h3>
          <p class="text-3xl font-bold text-yellow-600" id="inProgressTickets">0</p>
        </div>
        <div class="bg-green-100 p-4 rounded-lg">
          <h3 class="text-lg font-semibold text-green-800">Kapalı Talepler</h3>
          <p class="text-3xl font-bold text-green-600" id="closedTickets">0</p>
        </div>
      </div>
      
      <!-- Ticket List -->
      <div class="bg-white rounded-lg shadow">
        <div class="p-4 border-b border-gray-200">
          <h2 class="text-xl font-semibold">Strateji Talepleri</h2>
        </div>
        
        <div id="ticketList" class="p-4">
          <!-- Tickets will be populated here -->
        </div>
      </div>
    </div>
  </div>

  <!-- 🎫 Ticket Detail Modal -->
  <div id="ticketDetailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-gray-800">Ticket Detayı</h2>
        <button onclick="closeTicketDetail()" class="text-gray-500 hover:text-gray-700">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      
      <div id="ticketDetailContent">
        <!-- Ticket details will be populated here -->
      </div>
    </div>
  </div>

  <!-- 🏠 Hero Section -->
  <section id="hero" class="min-h-screen flex items-center justify-center pt-20 px-4 relative" style="background-image: url('./fotos/ana_sayfa.png'); background-size: cover; background-position: center; background-repeat: no-repeat;">
    <!-- Background overlay for better text readability -->
    <div class="absolute inset-0 bg-black bg-opacity-40"></div>
    
    <div class="text-center max-w-2xl relative z-10">
      <h1 class="text-4xl md:text-5xl font-bold mb-4 text-white drop-shadow-lg">Profesyonel Stratejilerle Ticaretinizi Geliştirin</h1>
      <p class="text-lg md:text-xl mb-6 text-white drop-shadow-md">Başarınız için özel olarak tasarlanmış güçlü TradingView scriptleri geliştiriyoruz.</p>
      <a href="#strategies" class="inline-block bg-indigo-600 text-white px-6 py-3 rounded-lg shadow hover:bg-indigo-700 transition">Stratejileri Keşfedin</a>
    </div>
  </section>

  <!-- 📈 Strategies Section -->
  <section id="strategies" class="py-16 bg-white px-4">
    <div class="max-w-7xl mx-auto">
      <h2 class="text-3xl font-bold text-center mb-12">Öne Çıkan Stratejilerimiz</h2>
      <div class="grid md:grid-cols-2 gap-8">
        
        <!-- Strategy 1 -->
        <div class="bg-gray-100 rounded-lg shadow p-6">
          <h3 class="text-2xl font-semibold mb-4">PSAR Strategy</h3>
          <img src="fotos/psar_strateji.png" alt="PSAR Strategy Chart" class="rounded mb-4 w-full">
          <p class="mb-4">PSAR ATR Stratejisi, Parabolic SAR ve Average True Range (ATR) göstergelerini birleştiren gelişmiş bir momentum tabanlı trading stratejisidir. Bu strateji, trend yönünü belirlemek için PSAR noktalarını kullanırken, ATR ile volatilite bazlı stop-loss ve take-profit seviyeleri belirler. Özellikle güçlü trendlerde yüksek kazanç potansiyeli sunar ve ani fiyat hareketlerine karşı koruma sağlar. Strateji, 15 dakikalık timeframe'de çalışarak hem kısa vadeli fırsatları yakalar hem de trend devam ederken pozisyonları korur.</p>
          <button class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">Satın Al</button>
        </div>

        <!-- Strategy 2 -->
        <div class="bg-gray-100 rounded-lg shadow p-6">
          <h3 class="text-2xl font-semibold mb-4">ATR Strategy</h3>
          <img src="fotos/atr_strateji.png" alt="ATR Strategy Chart" class="rounded mb-4 w-full">
          <p class="mb-4">ATR Stratejisi, Average True Range göstergesine dayalı volatilite odaklı bir trading yaklaşımıdır. Bu strateji, piyasa volatilitesini analiz ederek optimal giriş ve çıkış noktalarını belirler. ATR değerlerine göre dinamik stop-loss seviyeleri ayarlar ve risk yönetimini volatilite bazlı yapar. Strateji, düşük volatilite dönemlerinde daha konservatif, yüksek volatilite dönemlerinde ise daha agresif pozisyonlar alır. Bu yaklaşım, piyasa koşullarına adapte olarak tutarlı performans sağlar.</p>
          <button class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">Satın Al</button>
        </div>

      </div>
    </div>
  </section>

  <!-- 🌟 Premium Content Section -->
  <section id="premiumContent" class="hidden py-16 bg-gradient-to-r from-indigo-600 to-purple-600">
    <div class="max-w-7xl mx-auto px-4 text-center text-white">
      <h2 class="text-3xl font-bold mb-4">🎉 Premium Üye Avantajlarınız</h2>
      <p class="text-xl mb-8">Giriş yaptığınız için özel indirimler ve avantajlar sizi bekliyor!</p>
      
      <div class="grid md:grid-cols-3 gap-8 mb-8">
        <div class="bg-white bg-opacity-20 p-6 rounded-lg">
          <h3 class="text-xl font-semibold mb-2">📈 Ücretsiz Analiz</h3>
          <p>Kişisel trading analizi ve strateji önerileri</p>
        </div>
        <div class="bg-white bg-opacity-20 p-6 rounded-lg">
          <h3 class="text-xl font-semibold mb-2">💰 %20 İndirim</h3>
          <p>Tüm stratejilerde özel üye indirimi</p>
        </div>
        <div class="bg-white bg-opacity-20 p-6 rounded-lg">
          <h3 class="text-xl font-semibold mb-2">🎯 Öncelikli Destek</h3>
          <p>7/24 öncelikli teknik destek hizmeti</p>
        </div>
      </div>
      
      <p class="text-lg">Hoşgeldiniz <span id="premiumUserName" class="font-bold"></span>! 🚀</p>
    </div>
  </section>

  <!-- 🧾 Request Custom Strategy Section -->
  <section id="request" class="py-16 bg-gray-50 px-4">
    <div class="max-w-2xl mx-auto">
      <h2 class="text-3xl font-bold text-center mb-4">Strateji Talebi</h2>
      <p class="text-center mb-8">Hangi stratejimizi satın almak istiyorsunuz? Aşağıdaki formu doldurarak talebinizi iletebilirsiniz. Uzman ekibimiz en kısa sürede sizinle iletişime geçecektir.</p>
      
      <!-- Login Required Message -->
      <div id="loginRequiredMessage" class="hidden bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded mb-6 text-center">
        <p class="mb-2">Strateji talebi için giriş yapmanız gerekiyor.</p>
        <button onclick="openLoginModal()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded transition">
          Giriş Yap
        </button>
      </div>
      
      <form id="strategyForm" onsubmit="handleFormSubmit(event)" class="space-y-6 bg-white p-6 rounded-lg shadow">
        <div>
          <label class="block mb-1 font-medium">İsim</label>
          <input type="text" id="name" class="w-full border border-gray-300 rounded px-4 py-2" required />
        </div>
        <div>
          <label class="block mb-1 font-medium">E-posta</label>
          <input type="email" id="email" class="w-full border border-gray-300 rounded px-4 py-2" required />
        </div>
        <div>
          <label class="block mb-1 font-medium">TradingView Kullanıcı Adı</label>
          <input type="text" id="tradingViewUsername" class="w-full border border-gray-300 rounded px-4 py-2" required />
        </div>
        <div>
          <label class="block mb-1 font-medium">İstediğiniz Strateji</label>
          <select id="selectedStrategy" class="w-full border border-gray-300 rounded px-4 py-2" required>
            <option value="">Bir strateji seçin</option>
          </select>
        </div>
        <div>
          <label class="block mb-1 font-medium">Not Yazınız</label>
          <textarea id="notes" class="w-full border border-gray-300 rounded px-4 py-2" rows="4" placeholder="Ek bilgi veya özel talepleriniz varsa buraya yazabilirsiniz..."></textarea>
        </div>
        <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded hover:bg-indigo-700">Talep Gönder</button>
      </form>
    </div>
  </section>

  <!-- 📬 Contact Section (Footer) -->
  <footer id="contact" class="bg-white py-12 border-t">
    <div class="max-w-7xl mx-auto px-4 text-center">
      <h3 class="text-2xl font-semibold mb-4">İletişim</h3>
      <p class="mb-2">E-posta: <a href="mailto:info@eralpahmettrading.com" class="text-indigo-600 hover:underline">info@eralpahmettrading.com</a></p>
      <div class="flex justify-center space-x-6 mt-4 text-xl">
        <a href="#" class="hover:text-indigo-500" title="Telegram">📨</a>
        <a href="#" class="hover:text-indigo-500" title="Discord">💬</a>
      </div>
      <p class="mt-8 text-sm text-gray-500">© 2025 EralpAhmet Trading Company. Tüm hakları saklıdır.</p>
    </div>
  </footer>

  <script>
    // Global authentication state
    let isAuthenticated = false;
    let currentUser = null;

    // Initialize dropdown when page loads
    document.addEventListener('DOMContentLoaded', function() {
      populateStrategyDropdown();
      initializeAuth();
    });

    // Initialize authentication
    function initializeAuth() {
      // Initialize Google Sign-In
      google.accounts.id.initialize({
        client_id: config.auth.googleClientId,
        callback: handleGoogleSignIn
      });

      // Render Google Sign-In button
      google.accounts.id.renderButton(
        document.getElementById('googleSignInButton'),
        {
          theme: 'outline',
          size: 'large',
          text: 'continue_with',
          shape: 'rectangular',
          width: 250
        }
      );

      // Initialize reCAPTCHA
      if (typeof grecaptcha !== 'undefined') {
        grecaptcha.render('recaptchaContainer', {
          'sitekey': config.auth.recaptchaSiteKey
        });
      }

      // Check if user is already logged in
      checkAuthState();
    }

    // Check authentication state
    function checkAuthState() {
      const savedUser = localStorage.getItem('currentUser');
      if (savedUser) {
        currentUser = JSON.parse(savedUser);
        isAuthenticated = true;
        updateAuthUI();
      }
    }

    // Handle Google Sign-In
    function handleGoogleSignIn(response) {
      const credential = parseJwt(response.credential);
      
      currentUser = {
        id: credential.sub,
        name: credential.name,
        email: credential.email,
        picture: credential.picture,
        loginMethod: 'google',
        userType: 'google'
      };
      
      isAuthenticated = true;
      localStorage.setItem('currentUser', JSON.stringify(currentUser));
      updateAuthUI();
      closeLoginModal();
      
      // Show success message
      showMessage('Başarıyla giriş yaptınız!', 'success');
    }

    // Parse JWT token
    function parseJwt(token) {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
      return JSON.parse(jsonPayload);
    }

    // Regular login with email/password
    function handleRegularLogin(email, password) {
      // Verify reCAPTCHA
      const recaptchaResponse = grecaptcha.getResponse();
      if (!recaptchaResponse) {
        showMessage('Lütfen reCAPTCHA\'yı tamamlayın.', 'error');
        return;
      }

      // Check test user credentials
      if (email === config.testUser.username && password === config.testUser.password) {
        currentUser = {
          id: 'testuser_' + Date.now(),
          name: 'Test Kullanıcısı',
          email: 'testuser@example.com',
          picture: null,
          loginMethod: 'testuser',
          userType: 'test'
        };
        
        isAuthenticated = true;
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        updateAuthUI();
        closeLoginModal();
        
        showMessage('Test kullanıcısı olarak giriş yaptınız!', 'success');
        return;
      }

      // Demo authentication for email format (in real app, this would be server-side)
      if (email && password && email.includes('@')) {
        currentUser = {
          id: Date.now().toString(),
          name: email.split('@')[0],
          email: email,
          picture: null,
          loginMethod: 'email',
          userType: 'regular'
        };
        
        isAuthenticated = true;
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        updateAuthUI();
        closeLoginModal();
        
        showMessage('Başarıyla giriş yaptınız!', 'success');
      } else {
        showMessage('Geçersiz kullanıcı adı veya şifre!', 'error');
      }
    }

    // Login modal functions
    function openLoginModal() {
      document.getElementById('loginModal').classList.remove('hidden');
      // Reset reCAPTCHA
      if (typeof grecaptcha !== 'undefined') {
        grecaptcha.reset();
      }
    }

    function closeLoginModal() {
      document.getElementById('loginModal').classList.add('hidden');
      document.getElementById('loginForm').reset();
    }

    // Logout function
    function logout() {
      isAuthenticated = false;
      currentUser = null;
      localStorage.removeItem('currentUser');
      
      // Sign out from Google
      if (typeof google !== 'undefined') {
        google.accounts.id.disableAutoSelect();
      }
      
      updateAuthUI();
      showMessage('Başarıyla çıkış yaptınız.', 'success');
    }

    // Update authentication UI
    function updateAuthUI() {
      const loginBtn = document.getElementById('loginBtn');
      const userInfo = document.getElementById('userInfo');
      const userName = document.getElementById('userName');
      const loginRequiredMessage = document.getElementById('loginRequiredMessage');
      const strategyForm = document.getElementById('strategyForm');
      const premiumContent = document.getElementById('premiumContent');
      const premiumUserName = document.getElementById('premiumUserName');
      
      if (isAuthenticated && currentUser) {
        // Header authentication
        loginBtn.classList.add('hidden');
        userInfo.classList.remove('hidden');
        if (currentUser.userType === 'test') {
          userName.textContent = currentUser.name + ' (Test)';
        } else {
          userName.textContent = currentUser.name;
        }
        
        // Strategy form
        loginRequiredMessage.classList.add('hidden');
        strategyForm.classList.remove('hidden');
        
        // Premium content
        premiumContent.classList.remove('hidden');
        if (currentUser.userType === 'test') {
          premiumUserName.textContent = currentUser.name + ' (Test Kullanıcısı)';
        } else {
          premiumUserName.textContent = currentUser.name;
        }
      } else {
        // Header authentication
        loginBtn.classList.remove('hidden');
        userInfo.classList.add('hidden');
        userName.textContent = '';
        
        // Strategy form
        loginRequiredMessage.classList.remove('hidden');
        strategyForm.classList.add('hidden');
        
        // Premium content
        premiumContent.classList.add('hidden');
        premiumUserName.textContent = '';
      }
    }

    // Show message function
    function showMessage(message, type) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 ${
        type === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
      }`;
      messageDiv.textContent = message;
      
      document.body.appendChild(messageDiv);
      
      setTimeout(() => {
        messageDiv.remove();
      }, 3000);
    }

    // Handle login form submission
    document.addEventListener('DOMContentLoaded', function() {
      const loginForm = document.getElementById('loginForm');
      loginForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        handleRegularLogin(email, password);
      });
    });

    // Populate strategy dropdown from config
    function populateStrategyDropdown() {
      const select = document.getElementById('selectedStrategy');
      config.strategies.forEach(strategy => {
        const option = document.createElement('option');
        option.value = strategy;
        option.textContent = strategy;
        select.appendChild(option);
      });
    }

    // Handle form submission
    function handleFormSubmit(event) {
      event.preventDefault();
      
      // Check if user is logged in
      if (!isAuthenticated) {
        showMessage('Strateji talebi için giriş yapmanız gerekiyor.', 'error');
        openLoginModal();
        return;
      }
      
      const formData = {
        name: document.getElementById('name').value,
        email: document.getElementById('email').value,
        tradingViewUsername: document.getElementById('tradingViewUsername').value,
        selectedStrategy: document.getElementById('selectedStrategy').value,
        notes: document.getElementById('notes').value
      };

      // Send email
      sendEmail(formData);
    }

    // Send email function
    function sendEmail(data) {
      // Create ticket
      const ticket = {
        id: Date.now(),
        name: data.name,
        email: data.email,
        tradingViewUsername: data.tradingViewUsername,
        selectedStrategy: data.selectedStrategy,
        notes: data.notes,
        status: 'open',
        createdAt: new Date().toISOString(),
        responses: []
      };

      // Save ticket to localStorage
      let tickets = JSON.parse(localStorage.getItem('tickets') || '[]');
      tickets.push(ticket);
      localStorage.setItem('tickets', JSON.stringify(tickets));

      const subject = encodeURIComponent(config.email.subject);
      const body = encodeURIComponent(
        `Yeni Strateji Talebi Detayları:\n\n` +
        `Ticket ID: ${ticket.id}\n` +
        `İsim: ${data.name}\n` +
        `E-posta: ${data.email}\n` +
        `TradingView Kullanıcı Adı: ${data.tradingViewUsername}\n` +
        `İstenen Strateji: ${data.selectedStrategy}\n` +
        `Notlar: ${data.notes}\n\n` +
        `Talep Tarihi: ${new Date().toLocaleString('tr-TR')}`
      );

      // Open email client with pre-filled data
      const mailtoLink = `mailto:${config.email.recipient}?subject=${subject}&body=${body}`;
      window.location.href = mailtoLink;

      // Show success message
      showMessage(`Talebiniz alındı! Ticket ID: ${ticket.id}. E-posta istemciniz açılacak.`, 'success');
      
      // Reset form
      document.getElementById('strategyForm').reset();
    }

    // ======= ADMIN PANEL FUNCTIONS =======
    
    // Admin state
    let isAdminLoggedIn = false;
    let currentTickets = [];

    // Open admin modal
    function openAdminModal() {
      document.getElementById('adminModal').classList.remove('hidden');
    }

    // Close admin modal
    function closeAdminModal() {
      document.getElementById('adminModal').classList.add('hidden');
      document.getElementById('adminLoginForm').reset();
    }

    // Admin login
    function handleAdminLogin(username, password) {
      if (username === config.admin.username && password === config.admin.password) {
        isAdminLoggedIn = true;
        closeAdminModal();
        showAdminPanel();
        showMessage('Admin girişi başarılı!', 'success');
      } else {
        showMessage('Kullanıcı adı veya şifre hatalı!', 'error');
      }
    }

    // Show admin panel
    function showAdminPanel() {
      document.getElementById('adminPanel').classList.remove('hidden');
      loadTickets();
      updateTicketStatistics();
    }

    // Close admin panel
    function closeAdminPanel() {
      document.getElementById('adminPanel').classList.add('hidden');
      isAdminLoggedIn = false;
      showMessage('Admin çıkışı yapıldı.', 'success');
    }

    // Load tickets from localStorage
    function loadTickets() {
      currentTickets = JSON.parse(localStorage.getItem('tickets') || '[]');
      displayTickets();
    }

    // Display tickets in admin panel
    function displayTickets() {
      const ticketList = document.getElementById('ticketList');
      
      if (currentTickets.length === 0) {
        ticketList.innerHTML = '<p class="text-gray-500 text-center py-4">Henüz hiç strateji talebi yok.</p>';
        return;
      }

      ticketList.innerHTML = currentTickets.map(ticket => {
        const statusColors = {
          'open': 'bg-blue-100 text-blue-800',
          'inprogress': 'bg-yellow-100 text-yellow-800',
          'closed': 'bg-green-100 text-green-800'
        };

        const statusTexts = {
          'open': 'Açık',
          'inprogress': 'Devam Ediyor',
          'closed': 'Kapalı'
        };

        return `
          <div class="border border-gray-200 rounded-lg p-4 mb-4 hover:shadow-md transition">
            <div class="flex justify-between items-start">
              <div class="flex-1">
                <h3 class="font-semibold text-lg">Ticket #${ticket.id}</h3>
                <p class="text-gray-600">👤 ${ticket.name} (${ticket.email})</p>
                <p class="text-gray-600">📈 ${ticket.selectedStrategy}</p>
                <p class="text-gray-500 text-sm">📅 ${new Date(ticket.createdAt).toLocaleString('tr-TR')}</p>
              </div>
              <div class="flex flex-col items-end space-y-2">
                <span class="px-3 py-1 rounded-full text-xs font-medium ${statusColors[ticket.status]}">
                  ${statusTexts[ticket.status]}
                </span>
                <button onclick="showTicketDetail(${ticket.id})" class="bg-indigo-600 text-white px-3 py-1 rounded text-sm hover:bg-indigo-700">
                  Detayları Görüntüle
                </button>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    // Show ticket detail
    function showTicketDetail(ticketId) {
      const ticket = currentTickets.find(t => t.id === ticketId);
      if (!ticket) return;

      const statusOptions = [
        { value: 'open', text: 'Açık' },
        { value: 'inprogress', text: 'Devam Ediyor' },
        { value: 'closed', text: 'Kapalı' }
      ];

      const statusSelect = statusOptions.map(option => 
        `<option value="${option.value}" ${ticket.status === option.value ? 'selected' : ''}>${option.text}</option>`
      ).join('');

      const responsesHtml = ticket.responses.map(response => `
        <div class="bg-gray-50 p-3 rounded mb-2">
          <p class="text-sm text-gray-600">📅 ${new Date(response.timestamp).toLocaleString('tr-TR')}</p>
          <p class="mt-1">${response.message}</p>
        </div>
      `).join('');

      document.getElementById('ticketDetailContent').innerHTML = `
        <div class="space-y-4">
          <div class="bg-gray-50 p-4 rounded-lg">
            <h3 class="font-semibold mb-2">Ticket Bilgileri</h3>
            <p><strong>ID:</strong> ${ticket.id}</p>
            <p><strong>İsim:</strong> ${ticket.name}</p>
            <p><strong>E-posta:</strong> ${ticket.email}</p>
            <p><strong>TradingView:</strong> ${ticket.tradingViewUsername}</p>
            <p><strong>İstenen Strateji:</strong> ${ticket.selectedStrategy}</p>
            <p><strong>Tarih:</strong> ${new Date(ticket.createdAt).toLocaleString('tr-TR')}</p>
            <p><strong>Notlar:</strong> ${ticket.notes || 'Yok'}</p>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Ticket Durumu</label>
            <select id="ticketStatus" class="w-full px-3 py-2 border border-gray-300 rounded-md">
              ${statusSelect}
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Cevaplar</label>
            <div class="max-h-60 overflow-y-auto">
              ${responsesHtml || '<p class="text-gray-500">Henüz cevap yok.</p>'}
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Yeni Cevap</label>
            <textarea id="newResponse" class="w-full px-3 py-2 border border-gray-300 rounded-md" rows="3" placeholder="Cevabınızı yazın..."></textarea>
          </div>

          <div class="flex space-x-3">
            <button onclick="updateTicketStatus(${ticket.id})" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
              Durumu Güncelle
            </button>
            <button onclick="addResponse(${ticket.id})" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
              Cevap Ekle
            </button>
          </div>
        </div>
      `;

      document.getElementById('ticketDetailModal').classList.remove('hidden');
    }

    // Close ticket detail
    function closeTicketDetail() {
      document.getElementById('ticketDetailModal').classList.add('hidden');
    }

    // Update ticket status
    function updateTicketStatus(ticketId) {
      const newStatus = document.getElementById('ticketStatus').value;
      
      // Update in currentTickets array
      const ticket = currentTickets.find(t => t.id === ticketId);
      if (ticket) {
        ticket.status = newStatus;
        
        // Update localStorage
        localStorage.setItem('tickets', JSON.stringify(currentTickets));
        
        // Refresh displays
        displayTickets();
        updateTicketStatistics();
        
        showMessage('Ticket durumu güncellendi!', 'success');
      }
    }

    // Add response to ticket
    function addResponse(ticketId) {
      const responseText = document.getElementById('newResponse').value.trim();
      if (!responseText) {
        showMessage('Cevap boş olamaz!', 'error');
        return;
      }

      const ticket = currentTickets.find(t => t.id === ticketId);
      if (ticket) {
        ticket.responses.push({
          message: responseText,
          timestamp: new Date().toISOString()
        });

        // Update localStorage
        localStorage.setItem('tickets', JSON.stringify(currentTickets));
        
        // Refresh ticket detail
        showTicketDetail(ticketId);
        
        showMessage('Cevap eklendi!', 'success');
      }
    }

    // Update ticket statistics
    function updateTicketStatistics() {
      const stats = {
        open: currentTickets.filter(t => t.status === 'open').length,
        inprogress: currentTickets.filter(t => t.status === 'inprogress').length,
        closed: currentTickets.filter(t => t.status === 'closed').length
      };

      document.getElementById('openTickets').textContent = stats.open;
      document.getElementById('inProgressTickets').textContent = stats.inprogress;
      document.getElementById('closedTickets').textContent = stats.closed;
    }

    // Admin form submission
    document.addEventListener('DOMContentLoaded', function() {
      const adminLoginForm = document.getElementById('adminLoginForm');
      adminLoginForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const username = document.getElementById('adminUsername').value;
        const password = document.getElementById('adminPassword').value;
        handleAdminLogin(username, password);
      });
    });
  </script>

</body>
</html> 